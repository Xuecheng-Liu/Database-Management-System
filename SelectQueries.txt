/* simple queries */
SELECT ITEM.Title
FROM ITEM, STORE, PRICE
WHERE PRICE.USD_Price < 10 AND STORE.Name = "Liberty Music" AND ITEM.Item_ID = PRICE.Item_ID AND STORE.Store_ID = ITEM.Store_ID;

SELECT ITEM.Title, ORDER_TABLE.Purchase_Date
FROM ITEM, ORDER_TABLE, SHOPPING_CART, CONTAINS, USER
WHERE USER.Fname = "Olivia" AND SHOPPING_CART.User_ID = USER.User_ID AND CONTAINS.Cart_ID = SHOPPING_CART.Cart_ID AND CONTAINS.Item_ID = ITEM.Item_ID AND ORDER_TABLE.Cart_ID = SHOPPING_CART.Cart_ID;

SELECT USER.Fname, User.Lname
FROM USER, STORE, ITEM
WHERE USER.User_ID = STORE.User_ID AND STORE.Store_ID = ITEM.Store_ID 
Group BY (STORE.Name)
HAVING COUNT(ITEM.Item_ID) < 5;

SELECT USER.Fname, USER.Lname, ITEM.Title
FROM USER, STORE, ITEM, ORDER_TABLE, SHOPPING_CART, CONTAINS
WHERE USER.User_ID = SHOPPING_CART.User_ID AND CONTAINS.CART_ID = SHOPPING_CART.Cart_ID AND CONTAINS.Item_ID = ITEM.Item_ID AND ORDER_TABLE.Cart_ID = SHOPPING_CART.Cart_ID AND ITEM.Store_ID = STORE.Store_ID AND STORE.Name = "Liberty Music";

SELECT COUNT(ITEM.Item_ID) AS Total_Items_Purchased
FROM USER, SHOPPING_CART, CONTAINS, ORDER_TABLE, ITEM
WHERE USER.User_ID = SHOPPING_CART.User_ID AND CONTAINS.CART_ID = SHOPPING_CART.Cart_ID AND CONTAINS.Item_ID = ITEM.Item_ID AND ORDER_TABLE.Cart_ID = SHOPPING_CART.Cart_ID AND USER.User_ID = 1;

SELECT User_ID, MAX(Purchased_Items_Count)
FROM (SELECT USER.User_ID, Count(ITEM.Item_ID) AS Purchased_Items_Count
FROM USER, SHOPPING_CART, CONTAINS, ORDER_TABLE, ITEM
WHERE USER.User_ID = SHOPPING_CART.User_ID AND CONTAINS.CART_ID = SHOPPING_CART.Cart_ID AND CONTAINS.Item_ID = ITEM.Item_ID AND ORDER_TABLE.Cart_ID = SHOPPING_CART.Cart_ID
GROUP BY USER.User_ID);

/* advanced queries */
SELECT USER.Fname, USER.Lname, SUM(ORDER_PAYMENT.Amount_Paid) AS Total
FROM USER, SHOPPING_CART, ORDER_TABLE, ORDER_PAYMENT
WHERE USER.User_ID = SHOPPING_CART.User_ID AND SHOPPING_CART.Cart_ID = ORDER_TABLE.Cart_ID AND ORDER_TABLE.Order_ID = ORDER_PAYMENT.Order_ID
GROUP BY USER.User_ID;

SELECT Fname, Lname, Email
FROM (SELECT USER.Fname, USER.Lname, User.Email, SUM(ORDER_PAYMENT.Amount_Paid) AS Total_Paid
FROM USER, SHOPPING_CART, ORDER_TABLE, ORDER_PAYMENT
WHERE USER.User_ID = SHOPPING_CART.User_ID AND SHOPPING_CART.Cart_ID = ORDER_TABLE.Cart_ID AND ORDER_TABLE.Order_ID = ORDER_PAYMENT.Order_ID
GROUP BY USER.User_ID)
WHERE Total_Paid < (SELECT AVG(Total_Paid) FROM (SELECT SUM(ORDER_PAYMENT.Amount_Paid) AS Total_Paid
FROM ORDER_PAYMENT));

SELECT ITEM.Title, SUM(CONTAINS.Quantity) AS Total_Copies_Sold
FROM ORDER_TABLE, SHOPPING_CART, CONTAINS, ITEM
WHERE ORDER_TABLE.Cart_ID = SHOPPING_CART.Cart_ID AND SHOPPING_CART.Cart_ID = CONTAINS.Cart_ID AND CONTAINS.Item_ID = ITEM.Item_ID
GROUP BY ITEM.Item_ID
ORDER BY Total_Copies_Sold DESC;

SELECT Title, Price.USD_Price * Total_Copies_Sold AS Total_Profits
FROM (SELECT ITEM.Item_ID, ITEM.Title, SUM(CONTAINS.Quantity) AS Total_Copies_Sold
FROM ORDER_TABLE, SHOPPING_CART, CONTAINS, ITEM
WHERE ORDER_TABLE.Cart_ID = SHOPPING_CART.Cart_ID AND SHOPPING_CART.Cart_ID = CONTAINS.Cart_ID AND CONTAINS.Item_ID = ITEM.Item_ID
GROUP BY ITEM.Item_ID) AS QUANTITY, PRICE
	WHERE PRICE.Item_ID = QUANTITY.Item_ID
	ORDER BY Total_Profits DESC;

SELECT Store_ID, MAX(Total_Products_Sold) AS Max_Products_Sold
FROM(SELECT Store_ID, SUM(Total_Copies_Sold) AS Total_Products_Sold
  	FROM(SELECT STORE.Store_ID, ITEM.Title, SUM(CONTAINS.Quantity) AS Total_Copies_Sold
		FROM ORDER_TABLE, SHOPPING_CART, CONTAINS, ITEM, STORE
		WHERE ORDER_TABLE.Cart_ID = SHOPPING_CART.Cart_ID AND SHOPPING_CART.Cart_ID = CONTAINS.Cart_ID AND CONTAINS.Item_ID = ITEM.Item_ID AND STORE.Store_ID = ITEM.Store_ID
		GROUP BY ITEM.Item_ID)
	GROUP BY Store_ID);

SELECT Store_ID, SUM(Total_Profits) AS Profits
FROM (SELECT Store_ID, Title, PRICE.USD_Price * Total_Copies_Sold AS Total_Profits
FROM (SELECT ITEM.Store_ID, ITEM.Item_ID, ITEM.Title, SUM(CONTAINS.Quantity) AS Total_Copies_Sold
FROM ORDER_TABLE, SHOPPING_CART, CONTAINS, ITEM
WHERE ORDER_TABLE.Cart_ID = SHOPPING_CART.Cart_ID AND SHOPPING_CART.Cart_ID = CONTAINS.Cart_ID AND CONTAINS.Item_ID = ITEM.Item_ID
GROUP BY ITEM.Item_ID) AS QUANTITY, PRICE
		WHERE PRICE.Item_ID = QUANTITY.Item_ID)

SELECT USER.Fname, USER.Lname
FROM USER, SHOPPING_CART, ORDER_TABLE, CONTAINS, ITEM, (SELECT Store_ID, SUM(Total_Profits) AS Profits
FROM (SELECT Store_ID, Title, PRICE.USD_Price * Total_Copies_Sold AS Total_Profits
FROM (SELECT ITEM.Store_ID, ITEM.Item_ID, ITEM.Title, SUM(CONTAINS.Quantity) AS Total_Copies_Sold
FROM ORDER_TABLE, SHOPPING_CART, CONTAINS, ITEM
WHERE ORDER_TABLE.Cart_ID = SHOPPING_CART.Cart_ID AND SHOPPING_CART.Cart_ID = CONTAINS.Cart_ID AND CONTAINS.Item_ID = ITEM.Item_ID
GROUP BY ITEM.Item_ID) AS QUANTITY, PRICE
		WHERE PRICE.Item_ID = QUANTITY.Item_ID)
) AS MostProfitSeller
WHERE MostProfitSeller.Store_ID = ITEM.Store_ID AND USER.User_ID = SHOPPING_CART.User_ID AND ORDER_TABLE.Cart_ID = SHOPPING_CART.Cart_ID AND SHOPPING_CART.Cart_ID = CONTAINS.Cart_ID AND ITEM.Item_ID = CONTAINS.Item_ID
GROUP BY USER.User_ID;

SELECT STORE.Store_ID
FROM USER, STORE, ORDER_TABLE, SHOPPING_CART, CONTAINS, ITEM
WHERE USER.User_ID = SHOPPING_CART.User_ID AND CONTAINS.Cart_ID = SHOPPING_CART.Cart_ID AND ORDER_TABLE.Cart_ID = SHOPPING_CART.Cart_ID AND CONTAINS.Item_ID = ITEM.Item_ID AND STORE.Store_ID = ITEM.Store_ID AND USER.User_ID IN (SELECT User_ID
FROM (SELECT USER.User_ID, SUM(ORDER_PAYMENT.Amount_Paid) AS Total_Paid
FROM USER, SHOPPING_CART, ORDER_TABLE, ORDER_PAYMENT
WHERE USER.User_ID = SHOPPING_CART.User_ID AND SHOPPING_CART.Cart_ID = ORDER_TABLE.Cart_ID AND ORDER_TABLE.Order_ID = ORDER_PAYMENT.Order_ID
GROUP BY USER.User_ID)
WHERE Total_Paid < (SELECT AVG(Total_Paid) FROM (SELECT SUM(ORDER_PAYMENT.Amount_Paid) AS Total_Paid
FROM ORDER_PAYMENT)))
GROUP BY STORE.Store_ID;

/* extra queries */
SELECT COUNT(DISTINCT Store_ID) AS Stores_Using_Promos
FROM PROMO_CODE;

SELECT Store.Name
FROM FAVORITES, STORE
WHERE FAVORITES.Store_ID = STORE.Store_ID AND FAVORITES.User_ID = 1;

SELECT STORE.Name, ITEM.Title
FROM (STORE LEFT OUTER JOIN ITEM ON ITEM.Store_ID = STORE.Store_ID)
ORDER BY STORE.Name, ITEM.Title;STORE.Store_ID
ORDER BY STORE.Name, ITEM.Title;

